<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>G√™nesis Azulejista ‚Äî Or√ßamentos</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  :root{
    --bg:#f4f6f8;
    --card:#ffffff;
    --accent:#ffbf00;
    --primary:#111827;
    --muted:#6b7280;
    --success:#25d366;
    --danger:#dc3545;
    --btn:#007bff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, "Segoe UI", Arial, sans-serif;
    background:var(--bg);
    color:var(--primary);
    -webkit-font-smoothing:antialiased;
  }

  /* Top menu */
  header{
    background:linear-gradient(90deg,#0f172a 0%, #111827 60%);
    color:#fff;
    padding:14px 16px;
    display:flex;
    align-items:center;
    gap:16px;
  }
  .logo {
    display:flex;
    align-items:center;
    gap:10px;
    cursor:default;
  }
  .logo .mark{
    width:46px;height:46px;border-radius:8px;
    background:linear-gradient(135deg,#ffcc00,#ff9a00);
    display:flex;align-items:center;justify-content:center;
    color:#111;font-weight:800;font-size:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
  }
  .logo .title{
    font-weight:700;font-size:18px;line-height:1;
  }
  nav{
    margin-left:auto; display:flex; gap:10px;
  }
  nav button{
    background:transparent;border:0;color:#fff;padding:8px 12px;border-radius:8px;
    cursor:pointer;font-weight:600;
  }
  nav button:hover{background:rgba(255,255,255,0.06)}

  /* main */
  .wrap{max-width:980px;margin:22px auto;padding:0 16px}
  .card{
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 18px rgba(12,12,20,0.06);
    margin-bottom:18px;
  }

  h2{margin:0 0 12px 0;font-size:20px}
  label{display:block;margin-top:10px;font-weight:600;color:var(--muted);font-size:13px}
  input, select, textarea {
    width:100%; padding:10px;border-radius:8px;border:1px solid #e6e9ee;
    margin-top:6px;font-size:15px;color:var(--primary);
  }
  textarea { min-height:84px; resize:vertical; }

  .row{display:flex;gap:12px}
  .col{flex:1}
  .col-2{flex:0 0 160px}
  .small{font-size:13px;color:var(--muted);margin-top:6px}

  /* buttons group */
  .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
  .btn{
    padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;
    background:var(--btn);color:#fff;
  }
  .btn.secondary{background:#6b7280}
  .btn.success{background:var(--success);color:#06372b}
  .btn.danger{background:var(--danger)}
  .btn.ghost{background:transparent;color:var(--primary);border:1px solid #e6e9ee}
  .btn.small{padding:8px 10px;font-size:14px}

  /* area nota gerada */
  .nota-wrapper{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
  .nota{
    flex:1;
    min-width:320px;
    background:linear-gradient(180deg,#fff,#fbfbfb);
    border-radius:10px;padding:18px;border:1px solid #eef2f7;
  }
  .nota header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .nota .logo-mini{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#ffcc00,#ff9a00);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#111}
  .nota h3{margin:0}
  .nota p{margin:6px 0;color:#222}
  .nota .line{border-top:1px dashed #e6e9ee;margin:12px 0}

  .nota .meta{display:flex;gap:12px;flex-wrap:wrap}
  .nota .meta div{flex:1;min-width:140px}

  .qrcode-box{width:180px;padding:14px;border-radius:8px;border:1px solid #eef2f7;background:#fff;text-align:center}
  .qrcode-canvas{display:block;margin:0 auto}

  /* saved notes */
  .list-note{border-radius:8px;padding:10px;border:1px solid #eef2f7;margin-bottom:10px;background:#fff}
  .list-note .head{display:flex;justify-content:space-between;align-items:center}
  .muted{color:var(--muted);font-size:13px}

  /* responsive */
  @media (max-width:720px){
    .row{flex-direction:column}
    nav{display:none}
  }
</style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="mark">GZ</div>
      <div class="title">G√™nesis Azulejista</div>
    </div>

    <nav>
      <button onclick="show('form')">‚ûï Novo Or√ßamento</button>
      <button onclick="show('saved')">üìö Notas Salvas</button>
      <button onclick="show('about')">‚ÑπÔ∏è Sobre</button>
    </nav>
  </header>

  <main class="wrap">
    <!-- FORM -->
    <section id="form" class="card">
      <h2>Preencher Or√ßamento</h2>

      <div class="row">
        <div class="col">
          <label>Data do Or√ßamento</label>
          <input type="date" id="dataOrc" />

          <label>Cliente (Nome)</label>
          <input id="cliente" placeholder="Nome do cliente">

          <label>Descri√ß√£o do Servi√ßo</label>
          <textarea id="descricao" placeholder="Ex: Revestimento de banheiro, assentamento porcelanato..."></textarea>

          <div class="row">
            <div class="col">
              <label>Valor Total (R$)</label>
              <input type="number" id="valor" step="0.01" min="0" />
            </div>
            <div class="col">
              <label>Sinal (R$)</label>
              <input type="number" id="sinal" step="0.01" min="0" />
            </div>
            <div class="col">
              <label>Restante (R$)</label>
              <input type="number" id="restante" step="0.01" min="0" />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Data In√≠cio</label>
              <input type="date" id="inicio" />
            </div>
            <div class="col">
              <label>Data T√©rmino</label>
              <input type="date" id="termino" />
            </div>
          </div>

        </div>

        <div class="col col-2">
          <label>Endere√ßo ‚Äî Rua</label>
          <input id="rua" placeholder="Rua">

          <label>N√∫mero</label>
          <input id="numero" placeholder="123">

          <label>Bairro</label>
          <input id="bairro" placeholder="Bairro">

          <label>Cidade</label>
          <input id="cidade" placeholder="Cidade">

          <label>Estado</label>
          <input id="estado" placeholder="MG" value="MG">

          <label>Forma de Pagamento</label>
          <select id="forma">
            <option>PIX</option>
            <option>Dinheiro</option>
            <option>Cart√£o de Cr√©dito</option>
            <option>Cart√£o de D√©bito</option>
          </select>

          <label>Prestador (Nome)</label>
          <input id="prestador" value="G√™nesis Azulejista">

          <label>CPF do Prestador</label>
          <input id="cpfPrestador" value="123.456.789-00">

          <label>Chave PIX (padr√£o)</label>
          <input id="chavePix" value="04461680681">
        </div>
      </div>

      <div class="actions">
        <button class="btn" onclick="quickFill()">‚ö° Preencher r√°pido</button>
        <button class="btn" onclick="computeRest()">üî¢ Calcular restante</button>
        <button class="btn" onclick="generateNote()">üßæ Gerar Nota</button>
        <button class="btn secondary" onclick="resetForm()">‚ôªÔ∏è Limpar</button>
        <button class="btn ghost" onclick="saveNote()">üíæ Salvar Nota</button>
      </div>
      <div class="small" style="margin-top:10px">Dica: clique "Calcular restante" para atualizar automaticamente a diferen√ßa entre total e sinal.</div>
    </section>

    <!-- NOTA GERADA -->
    <section id="nota" class="card" style="display:none;">
      <div class="nota-wrapper">
        <div class="nota" id="notaVisual">
          <header>
            <div class="logo-mini">GZ</div>
            <div>
              <h3>G√™nesis Azulejista</h3>
              <div class="muted">Especialista em porcelanato lastra ‚Äî BH e Regi√£o</div>
            </div>
          </header>

          <div style="margin-top:8px">
            <p><strong>Data:</strong> <span id="vData"></span></p>
            <p><strong>Cliente:</strong> <span id="vCliente"></span></p>
            <p><strong>Servi√ßo:</strong> <span id="vDescricao"></span></p>

            <div class="line"></div>

            <div class="meta">
              <div><strong>Valor Total:</strong><div>R$ <span id="vValor"></span></div></div>
              <div><strong>Sinal:</strong><div>R$ <span id="vSinal"></span></div></div>
              <div><strong>Restante:</strong><div>R$ <span id="vRestante"></span></div></div>
            </div>

            <div class="line"></div>

            <p><strong>Per√≠odo:</strong> <span id="vInicio"></span> ‚Äî <span id="vTermino"></span></p>
            <p><strong>Endere√ßo:</strong> <span id="vRua"></span>, <span id="vNumero"></span> ‚Äî <span id="vBairro"></span> / <span id="vCidade"></span> - <span id="vEstado"></span></p>
            <p><strong>Forma de Pagamento:</strong> <span id="vForma"></span></p>

            <div class="line"></div>

            <p><strong>Prestador:</strong> <span id="vPrestador"></span> ‚Äî CPF: <span id="vCpfPrestador"></span></p>
            <p><strong>Chave PIX:</strong> <span id="vChavePix"></span></p>

            <p class="muted" style="margin-top:12px;text-align:center;font-size:13px">Obrigado por confiar no nosso trabalho ‚Äî contato: (32) 99543-9612 ‚Ä¢ Instagram: @genesisazulejista</p>
          </div>
        </div>

        <div style="width:220px">
          <div class="qrcode-box card" id="qrcodeArea">
            <div style="font-weight:700;margin-bottom:8px">QR PIX</div>
            <canvas id="qrCanvas" class="qrcode-canvas"></canvas>
            <div class="small muted" style="margin-top:8px">Toque em "Gerar QR" para atualizar o c√≥digo.</div>
          </div>

          <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
            <button class="btn success" onclick="generateQR()">üî≥ Gerar QR</button>
            <button class="btn" onclick="printNote()">üñ®Ô∏è Imprimir Nota</button>
            <button class="btn" onclick="sendWhats()">üì≤ Enviar via WhatsApp</button>
            <button class="btn secondary" onclick="show('form')">‚úèÔ∏è Editar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- NOTAS SALVAS -->
    <section id="saved" class="card" style="display:none">
      <h2>Notas Salvas</h2>
      <div id="savedList" style="margin-top:12px"></div>
      <div style="margin-top:8px">
        <button class="btn danger" onclick="clearSaved()">üóëÔ∏è Limpar todas as notas salvas</button>
      </div>
    </section>

    <!-- SOBRE -->
    <section id="about" class="card" style="display:none">
      <h2>Sobre</h2>
      <p>Este sistema gera notas r√°pidas com QR Code PIX, impress√£o e envio por WhatsApp. As notas podem ser salvas localmente no navegador (Notas Salvas).</p>
      <p><strong>G√™nesis Azulejista</strong> ‚Äî atendimento em BH e regi√£o ‚Ä¢ contato: (32) 99543-9612</p>
    </section>
  </main>

<script>
  // --- Estado e utilit√°rios ---
  const STORAGE_KEY = "genesis_notas_v1";
  let currentNote = null;

  function show(id){
    document.getElementById('form').style.display = (id==='form') ? 'block' : 'none';
    document.getElementById('nota').style.display = (id==='nota') ? 'block' : 'none';
    document.getElementById('saved').style.display = (id==='saved') ? 'block' : 'none';
    document.getElementById('about').style.display = (id==='about') ? 'block' : 'none';
    if(id==='saved') renderSaved();
  }

  // inicial
  show('form');

  // --- Form helpers ---
  function quickFill(){
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('dataOrc').value = hoje;
    document.getElementById('cliente').value = "Jo√£o Silva";
    document.getElementById('descricao').value = "Revestimento de banheiro (porcelanato lastra)";
    document.getElementById('valor').value = "1500.00";
    document.getElementById('sinal').value = "500.00";
    computeRest();
    document.getElementById('inicio').value = hoje;
    document.getElementById('termino').value = hoje;
    document.getElementById('rua').value = "Rua das Flores";
    document.getElementById('numero').value = "123";
    document.getElementById('bairro').value = "Centro";
    document.getElementById('cidade').value = "Betim";
    document.getElementById('estado').value = "MG";
    document.getElementById('prestador').value = "G√™nesis Azulejista";
    document.getElementById('cpfPrestador').value = "123.456.789-00";
    document.getElementById('chavePix').value = "04461680681";
  }

  function computeRest(){
    const v = parseFloat(document.getElementById('valor').value) || 0;
    const s = parseFloat(document.getElementById('sinal').value) || 0;
    const rest = Math.max(0, v - s);
    document.getElementById('restante').value = rest.toFixed(2);
  }

  function resetForm(){
    if(!confirm("Limpar todos os campos do formul√°rio?")) return;
    document.querySelectorAll('#form input, #form textarea, #form select').forEach(el=>{
      if(el.id==='estado') return; // mant√©m padr√£o MG
      if(el.id==='prestador') return; // mant√©m prestador padr√£o se quiser
      el.value = '';
    });
  }

  // --- Gerar nota (visual) ---
  function generateNote(){
    computeRest();
    const nota = collectForm();
    if(!nota.cliente || !nota.descricao || !nota.valor){
      alert("Preencha pelo menos: Cliente, Descri√ß√£o e Valor.");
      return;
    }
    currentNote = nota;
    renderNote(nota);
    show('nota');
  }

  function collectForm(){
    return {
      data: document.getElementById('dataOrc').value || new Date().toISOString().split('T')[0],
      cliente: document.getElementById('cliente').value.trim(),
      descricao: document.getElementById('descricao').value.trim(),
      valor: parseFloat(document.getElementById('valor').value || 0).toFixed(2),
      sinal: parseFloat(document.getElementById('sinal').value || 0).toFixed(2),
      restante: parseFloat(document.getElementById('restante').value || 0).toFixed(2),
      inicio: document.getElementById('inicio').value || '-',
      termino: document.getElementById('termino').value || '-',
      rua: document.getElementById('rua').value || '-',
      numero: document.getElementById('numero').value || '-',
      bairro: document.getElementById('bairro').value || '-',
      cidade: document.getElementById('cidade').value || '-',
      estado: document.getElementById('estado').value || 'MG',
      forma: document.getElementById('forma').value,
      prestador: document.getElementById('prestador').value,
      cpfPrestador: document.getElementById('cpfPrestador').value,
      chavePix: document.getElementById('chavePix').value || '04461680681',
      createdAt: new Date().toISOString()
    };
  }

  function renderNote(n){
    document.getElementById('vData').innerText = formatDate(n.data);
    document.getElementById('vCliente').innerText = n.cliente;
    document.getElementById('vDescricao').innerText = n.descricao;
    document.getElementById('vValor').innerText = Number(n.valor).toFixed(2).replace('.',',');
    document.getElementById('vSinal').innerText = Number(n.sinal).toFixed(2).replace('.',',');
    document.getElementById('vRestante').innerText = Number(n.restante).toFixed(2).replace('.',',');
    document.getElementById('vInicio').innerText = n.inicio !== '-' ? formatDate(n.inicio) : '-';
    document.getElementById('vTermino').innerText = n.termino !== '-' ? formatDate(n.termino) : '-';
    document.getElementById('vRua').innerText = n.rua;
    document.getElementById('vNumero').innerText = n.numero;
    document.getElementById('vBairro').innerText = n.bairro;
    document.getElementById('vCidade').innerText = n.cidade;
    document.getElementById('vEstado').innerText = n.estado;
    document.getElementById('vForma').innerText = n.forma;
    document.getElementById('vPrestador').innerText = n.prestador;
    document.getElementById('vCpfPrestador').innerText = n.cpfPrestador;
    document.getElementById('vChavePix').innerText = n.chavePix;

    // limpa canvas qr se tiver
    const canvas = document.getElementById('qrCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }

  function formatDate(d){
    if(!d) return '-';
    const date = new Date(d);
    if(isNaN(date)) {
      // j√° √© string yyyy-mm-dd
      const parts = d.split('-');
      return parts.length===3 ? `${parts[2]}/${parts[1]}/${parts[0]}` : d;
    }
    return date.toLocaleDateString('pt-BR');
  }

  // --- QR Code ---
  async function generateQR(){
    if(!currentNote){
      alert("Gere a nota primeiro.");
      return;
    }
    const pix = buildPix(currentNote);
    // gera QR no canvas
    try {
      await QRCode.toCanvas(document.getElementById('qrCanvas'), pix, { width: 180 });
    } catch(e){
      alert("Erro ao gerar QR: " + e);
    }
  }

  // Simples string de demonstra√ß√£o ‚Äî para pagamento real, usar padr√£o EMV ou gerador oficial
  function buildPix(n){
    // texto resumido com info √∫til para cliente copiar/ler
    return `PIX: ${n.chavePix}\nValor: R$ ${Number(n.valor).toFixed(2)}\nFavorecido: ${n.prestador}\nDescri√ß√£o: ${n.descricao}`;
  }

  // --- Impress√£o ---
  function printNote(){
    if(!currentNote){
      alert("Gere a nota antes de imprimir.");
      return;
    }
    // cria janela com layout limpo da nota
    const notaHTML = document.getElementById('notaVisual').outerHTML;
    const win = window.open('','_blank','width=800,height=900');
    const style = document.querySelector('style').innerHTML;
    win.document.write(`<html><head><title>Nota - ${currentNote.cliente}</title><style>${style} body{background:#fff;padding:20px}</style></head><body>${notaHTML}</body></html>`);
    win.document.close();
    setTimeout(()=>{ win.print(); }, 300);
  }

  // --- WhatsApp enviar ---
  function sendWhats(){
    if(!currentNote){
      alert("Gere a nota antes de enviar.");
      return;
    }
    const n = currentNote;
    const mensagem =
`üßæ *Or√ßamento - G√™nesis Azulejista*
Data: ${formatDate(n.data)}
Cliente: ${n.cliente}
Servi√ßo: ${n.descricao}
Valor Total: R$ ${Number(n.valor).toFixed(2)}
Sinal: R$ ${Number(n.sinal).toFixed(2)}
Restante: R$ ${Number(n.restante).toFixed(2)}
Per√≠odo: ${n.inicio} at√© ${n.termino}
Endere√ßo: ${n.rua}, ${n.numero} - ${n.bairro}, ${n.cidade} - ${n.estado}
Forma: ${n.forma}
PIX: ${n.chavePix}

Obrigado por confiar no nosso trabalho!`;

    // n√∫mero padr√£o em branco (abre conversa) ‚Äî o usu√°rio pode escolher o contato no app
    const url = `https://wa.me/?text=${encodeURIComponent(mensagem)}`;
    window.open(url,'_blank');
  }

  // --- Salvar notas ---
  function loadSaved(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch(e){
      return [];
    }
  }
  function saveAll(list){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  }

  function saveNote(){
    const nota = collectForm();
    if(!nota.cliente || !nota.descricao || !nota.valor){
      alert("Preencha Cliente, Descri√ß√£o e Valor antes de salvar.");
      return;
    }
    const list = loadSaved();
    list.unshift(nota); // salva no topo
    saveAll(list);
    alert("Nota salva localmente.");
    renderSaved();
  }

  function renderSaved(){
    const list = loadSaved();
    const container = document.getElementById('savedList');
    container.innerHTML = '';
    if(list.length===0){
      container.innerHTML = '<div class="muted">Sem notas salvas.</div>';
      return;
    }
    list.forEach((n, idx)=>{
      const div = document.createElement('div');
      div.className = 'list-note';
      div.innerHTML = `
        <div class="head">
          <div>
            <strong>${n.cliente}</strong> <span class="muted">‚Ä¢ ${formatDate(n.data)}</span>
            <div class="muted" style="font-size:13px">${n.descricao}</div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:700">R$ ${Number(n.valor).toFixed(2)}</div>
            <div class="muted" style="font-size:13px">Restante R$ ${Number(n.restante).toFixed(2)}</div>
          </div>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small" onclick="loadSavedIntoForm(${idx})">‚úèÔ∏è Abrir</button>
          <button class="btn small ghost" onclick="previewSaved(${idx})">üîç Visualizar</button>
          <button class="btn small" onclick="sendSavedWh(${idx})">üì≤ Enviar Whats</button>
          <button class="btn small secondary" onclick="printSaved(${idx})">üñ® Imprimir</button>
          <button class="btn small danger" onclick="deleteSaved(${idx})">üóëÔ∏è Apagar</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function loadSavedIntoForm(index){
    const list = loadSaved();
    const n = list[index];
    if(!n) return;
    // preenche form com os dados
    document.getElementById('dataOrc').value = n.data;
    document.getElementById('cliente').value = n.cliente;
    document.getElementById('descricao').value = n.descricao;
    document.getElementById('valor').value = n.valor;
    document.getElementById('sinal').value = n.sinal;
    document.getElementById('restante').value = n.restante;
    document.getElementById('inicio').value = n.inicio;
    document.getElementById('termino').value = n.termino;
    document.getElementById('rua').value = n.rua;
    document.getElementById('numero').value = n.numero;
    document.getElementById('bairro').value = n.bairro;
    document.getElementById('cidade').value = n.cidade;
    document.getElementById('estado').value = n.estado;
    document.getElementById('forma').value = n.forma;
    document.getElementById('prestador').value = n.prestador;
    document.getElementById('cpfPrestador').value = n.cpfPrestador;
    document.getElementById('chavePix').value = n.chavePix;
    alert("Nota carregada no formul√°rio. Clique em 'Gerar Nota' para visualizar.");
    show('form');
  }

  function previewSaved(index){
    const list = loadSaved();
    const n = list[index];
    if(!n) return;
    currentNote = n;
    renderNote(n);
    show('nota');
  }

  function sendSavedWh(index){
    const list = loadSaved();
    const n = list[index];
    if(!n) return;
    currentNote = n;
    sendWhats();
  }

  function printSaved(index){
    const list = loadSaved();
    const n = list[index];
    if(!n) return;
    currentNote = n;
    renderNote(n);
    printNote();
  }

  function deleteSaved(index){
    if(!confirm("Apagar essa nota?")) return;
    const list = loadSaved();
    list.splice(index,1);
    saveAll(list);
    renderSaved();
  }

  function clearSaved(){
    if(!confirm("Apagar todas as notas salvas?")) return;
    localStorage.removeItem(STORAGE_KEY);
    renderSaved();
  }

  // --- startup ---
  window.addEventListener('load', ()=>{
    renderSaved();
  });

  // Atalho: enter em campos num√©ricos calcula
  document.getElementById('sinal').addEventListener('change', computeRest);
  document.getElementById('valor').addEventListener('change', computeRest);
</script>
</body>
</html>
