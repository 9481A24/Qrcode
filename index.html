<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Or√ßamento Profissional</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f3f4f6;margin:0;padding:20px;}
  .container{max-width:800px;margin:auto;}
  h1{text-align:center;color:#111827;}
  .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-bottom:20px;}
  label{display:block;margin-top:10px;font-weight:bold;}
  input,select,textarea{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:8px;}
  button{background:#007bff;color:#fff;border:none;padding:10px 12px;border-radius:8px;margin-top:15px;cursor:pointer;}
  button:hover{background:#0056b3;}
  .nota{background:#fff;padding:15px;border-radius:10px;margin-top:20px;}
  .controle{background:#e8ffe8;padding:15px;border-radius:10px;margin-top:20px;}
  .qr-area{display:flex;align-items:center;gap:10px;margin-top:10px;flex-wrap:wrap;}
  #qrcode{background:#fff;padding:8px;border-radius:10px;}
  .total-box{background:#c9f7c5;padding:10px;border-radius:10px;margin-top:10px;text-align:center;font-size:18px;font-weight:bold;}
  .limpar{background:#dc3545;margin-left:10px;}
  .limpar:hover{background:#a71d2a;}
  .copy-msg{color:green;font-weight:bold;margin-left:5px;}
  .whatsapp{background:#25d366;}
  .whatsapp:hover{background:#1da851;}
  .btn-group button { margin-right: 10px; }
</style>
</head>
<body>
  <div class="container">
    <h1>üìã Or√ßamento - Betim Azulejista</h1>

    <div class="card">
      <label>Nome do Cliente</label>
      <input type="text" id="nome">

      <label>CPF do Cliente</label>
      <input type="text" id="cpfCliente" maxlength="14" placeholder="000.000.000-00">

      <label>Endere√ßo</label>
      <input type="text" id="endereco">

      <label>N√∫mero</label>
      <input type="text" id="numero">

      <label>Bairro</label>
      <input type="text" id="bairro">

      <label>Cidade</label>
      <input type="text" id="cidade">

      <label>Estado</label>
      <input type="text" id="estado" value="MG" readonly>

      <label>Descri√ß√£o do Servi√ßo</label>
      <textarea id="descricao" rows="3"></textarea>

      <label>Valor Total (R$)</label>
      <input type="number" id="valor" step="0.01" oninput="atualizarRestante()">

      <label>Valor Recebido / Sinal (R$)</label>
      <input type="number" id="sinal" step="0.01" oninput="atualizarRestante()">

      <label>Restante Valor (R$)</label>
      <input type="number" id="restanteValor" readonly>

      <label>Como entrou</label>
      <select id="forma">
        <option value="PIX">PIX</option>
        <option value="Dinheiro">Dinheiro</option>
        <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
      </select>

      <label>Restante combinado para pagamento</label>
      <input type="date" id="dataRestante">

      <label>Data de In√≠cio</label>
      <input type="date" id="inicio">

      <label>Data de T√©rmino</label>
      <input type="date" id="termino">

      <label>Prestador (Nome)</label>
      <input type="text" id="prestador" value="G√™nesis Azulejista">

      <label>CPF do Prestador</label>
      <input type="text" id="cpf" value="123.456.789-00">

      <label>Chave PIX</label>
      <input type="text" id="chavePix" value="04461680681">

      <div class="qr-area">
        <div id="qrcode"></div>
        <button onclick="gerarQR()">Gerar QR PIX</button>
        <button onclick="copiarChave()">üìã Copiar Chave PIX</button>
        <span id="copyMsg" class="copy-msg" style="display:none;">‚úÖ Copiada!</span>
      </div>

      <div class="btn-group">
        <button onclick="gerarNota()">Gerar Nota e Salvar</button>
        <button onclick="imprimirNota()">üñ®Ô∏è Imprimir Nota</button>
        <button onclick="enviarWhatsApp()">üì≤ Enviar via WhatsApp</button>
        <button class="limpar" onclick="limparCampos()">üîÑ Limpar e iniciar outro</button>
        <button onclick="preencherRapido()">‚ö° Preencher r√°pido</button>
      </div>
    </div>

    <div id="notaGerada" class="nota" style="display:none;"></div>

    <div class="controle">
      <h3>üìä Controle do M√™s</h3>
      <div id="listaControle"></div>
      <div class="total-box">
        üí∞ Total do M√™s: R$ <span id="totalMes">0,00</span>
      </div>
      <button class="limpar" onclick="limparControle()">üóëÔ∏è Limpar Controle</button>
    </div>
  </div>

<script>
let registros = JSON.parse(localStorage.getItem("orcamentos3")) || [];

function atualizarRestante(){
  const valor = parseFloat(document.getElementById('valor').value) || 0;
  const sinal = parseFloat(document.getElementById('sinal').value) || 0;
  const restante = valor - sinal;
  document.getElementById('restanteValor').value = restante > 0 ? restante.toFixed(2) : "0.00";
}

function gerarQR(){
  const chave = document.getElementById('chavePix').value;
  const sinal = parseFloat(document.getElementById('sinal').value)||0;
  if(!chave){alert("Informe a chave PIX!");return;}
  const texto = `Pagamento para ${chave}\nValor: R$ ${sinal.toFixed(2)}`;
  document.getElementById('qrcode').innerHTML="";
  QRCode.toCanvas(texto,{width:150},function(err,canvas){
    if(err){alert("Erro ao gerar QR.");return;}
    document.getElementById('qrcode').appendChild(canvas);
  });
}

function copiarChave(){
  const chave = document.getElementById('chavePix').value;
  if(!chave){alert("Nenhuma chave PIX informada.");return;}
  navigator.clipboard.writeText(chave).then(()=>{
    const msg=document.getElementById("copyMsg");
    msg.style.display="inline";
    setTimeout(()=>msg.style.display="none",2000);
  });
}

function gerarNota(){
  const nome=document.getElementById('nome').value.trim();
  const cpfCliente=document.getElementById('cpfCliente').value.trim();
  const endereco=document.getElementById('endereco').value.trim();
  const numero=document.getElementById('numero').value.trim();
  const bairro=document.getElementById('bairro').value.trim();
  const cidade=document.getElementById('cidade').value.trim();
  const estado=document.getElementById('estado').value.trim();

  const descricao=document.getElementById('descricao').value.trim();
  const valor=parseFloat(document.getElementById('valor').value)||0;
  const sinal=parseFloat(document.getElementById('sinal').value)||0;
  const restante = valor - sinal;
  const forma=document.getElementById('forma').value;
  const dataRestante=document.getElementById('dataRestante').value;
  const inicio=document.getElementById('inicio').value;
  const termino=document.getElementById('termino').value;
  const prestador=document.getElementById('prestador').value;
  const cpfPrestador=document.getElementById('cpf').value;
  const chavePix=document.getElementById('chavePix').value;

  if(!nome || !cpfCliente || !endereco || !numero || !bairro || !cidade || !valor){
    alert("Por favor, preencha todos os dados obrigat√≥rios antes de gerar a nota!");
    return;
  }

  const enderecoCompleto = `${endereco}, ${numero} - ${bairro}, ${cidade} - ${estado}`;

  const notaHTML=`
    <h2>Nota de Or√ßamento</h2>
    <p><strong>Cliente:</strong> ${nome}</p>
    <p><strong>CPF:</strong> ${cpfCliente}</p>
    <p><strong>Endere√ßo:</strong> ${enderecoCompleto}</p>
    <p><strong>Servi√ßo:</strong> ${descricao}</p>
    <p><strong>Valor Total:</strong> R$ ${valor.toFixed(2)}</p>
    <p><strong>Valor Recebido:</strong> R$ ${sinal.toFixed(2)} (${forma})</p>
    <p><strong>Restante a pagar:</strong> R$ ${restante > 0 ? restante.toFixed(2) : "0.00"}</p>
    <p><strong>Restante combinado para pagamento:</strong> ${dataRestante ? new Date(dataRestante).toLocaleDateString('pt-BR') : "-"}</p>
    <p><strong>In√≠cio:</strong> ${inicio ? new Date(inicio).toLocaleDateString('pt-BR') : "-"} - <strong>T√©rmino:</strong> ${termino ? new Date(termino).toLocaleDateString('pt-BR') : "-"}</p>
    <hr>
    <p><strong>Prestador:</strong> ${prestador} - CPF: ${cpfPrestador}</p>
    ${forma==="PIX" ? `<p><strong>Chave PIX:</strong> ${chavePix}</p>` : ""}
    <p style="text-align:center;">üíº G√™nesis Azulejista - BH e Regi√£o</p>
  `;
  document.getElementById('notaGerada').innerHTML=notaHTML;
  document.getElementById('notaGerada').style.display="block";

  const registro={nome,cpfCliente,enderecoCompleto,descricao,valor,sinal,restante,forma,dataRestante,inicio,termino,prestador,cpfPrestador,chavePix,data:new Date().toLocaleDateString()};
  registros.push(registro);
  localStorage.setItem("orcamentos3",JSON.stringify(registros));
  atualizarControle();
}

function enviarWhatsApp(){
  const nome=document.getElementById('nome').value.trim();
  const cpfCliente=document.getElementById('cpfCliente').value.trim();
  const endereco=document.getElementById('endereco').value.trim();
  const numero=document.getElementById('numero').value.trim();
  const bairro=document.getElementById('bairro').value.trim();
  const cidade=document.getElementById('cidade').value.trim();
  const estado=document.getElementById('estado').value.trim();

  const descricao=document.getElementById('descricao').value.trim();
  const valor=parseFloat(document.getElementById('valor').value)||0;
  const sinal=parseFloat(document.getElementById('sinal').value)||0;
  const restante = valor - sinal;
  const forma=document.getElementById('forma').value;
  const chavePix=document.getElementById('chavePix').value;

  if(!nome || !cpfCliente || !endereco || !numero || !bairro || !cidade || !valor){
    alert("Por favor, gere a nota corretamente antes de enviar pelo WhatsApp.");
    return;
  }

  const enderecoCompleto = `${endereco}, ${numero} - ${bairro}, ${cidade} - ${estado}`;

  const msg = `üìã *Or√ßamento - G√™nesis Azulejista*\n\n` +
              `üë§ Cliente: ${nome}\n` +
              `üÜî CPF: ${cpfCliente}\n` +
              `üè† Endere√ßo: ${enderecoCompleto}\n` +
              `üß± Servi√ßo: ${descricao}\n` +
              `üí∞ Valor Total: R$ ${valor.toFixed(2)}\n` +
              `üíµ Sinal Recebido: R$ ${sinal.toFixed(2)} (${forma})\n` +
              `üí∏ Restante a pagar: R$ ${restante > 0 ? restante.toFixed(2) : "0.00"}\n` +
              (forma==="PIX" ? `üîë Chave PIX: ${chavePix}\n` : "") +
              `\nüìÖ Obrigado por confiar em nosso trabalho!`;

  const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
}

function atualizarControle(){
  const lista=document.getElementById('listaControle');
  lista.innerHTML="";
  let total=0;
  registros.forEach(r=>{
    total+=r.valor;
    lista.innerHTML+=`<p>üß± ${r.nome} - ${r.forma} - R$ ${r.valor.toFixed(2)} (${r.data})</p>`;
  });
  document.getElementById('totalMes').innerText=total.toFixed(2).replace('.',',');
}

function limparCampos(){
  if(confirm("Tem certeza que quer limpar todos os campos para um novo or√ßamento?")){
    document.querySelectorAll('input,textarea,select').forEach(e=>{
      if(e.id==="estado") return; // mantem MG
      if(e.id==="prestador") return; // mantem nome prestador
      if(e.id==="cpf") return; // mantem cpf prestador
      if(e.id==="chavePix") return; // mantem chave pix
      e.value="";
    });
    document.getElementById('restanteValor').value="";
    document.getElementById('notaGerada').style.display="none";
    document.getElementById('qrcode').innerHTML="";
  }
}

function limparControle(){
  if(confirm("Quer apagar todo o controle do m√™s?")){
    registros=[];
    localStorage.removeItem("orcamentos3");
    atualizarControle();
  }
}

function imprimirNota(){
  if(document.getElementById('notaGerada').style.display==="none"){
    alert("Gere a nota antes de imprimir.");
    return;
  }
  const conteudo = document.getElementById('notaGerada').innerHTML;
  const win = window.open('','','width=600,height=700');
  win.document.write(`<html><head><title>Nota de Or√ßamento</title></head><body>${conteudo}</body></html>`);
  win.document.close();
  win.focus();
  win.print();
  win.close();
}

function preencherRapido(){
  document.getElementById('nome').value = "Jo√£o Silva";
  document.getElementById('cpfCliente').value = "123.456.789-00";
  document.getElementById('endereco').value = "Rua das Flores";
  document.getElementById('numero').value = "123";
  document.getElementById('bairro').value = "Centro";
  document.getElementById('cidade').value = "Betim";
  document.getElementById('descricao').value = "Revestimento de banheiro";
  document.getElementById('valor').value = "1500.00";
  document.getElementById('sinal').value = "500.00";
  atualizarRestante();
  document.getElementById('forma').value = "PIX";
  const hoje = new Date().toISOString().split('T')[0];
  document.getElementById('dataRestante').value = hoje;
  document.getElementById('inicio').value = hoje;
  document.getElementById('termino').value = hoje;
}

window.onload = function(){
  atualizarControle();
}
</script>
</body>
</html>
