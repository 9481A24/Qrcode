<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Or√ßamento Profissional</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f3f4f6;margin:0;padding:20px;}
  .container{max-width:800px;margin:auto;}
  h1{text-align:center;color:#111827;}
  .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-bottom:20px;}
  label{display:block;margin-top:10px;font-weight:bold;}
  input,select,textarea{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:8px;}
  button{background:#007bff;color:#fff;border:none;padding:10px 12px;border-radius:8px;margin-top:15px;cursor:pointer;}
  button:hover{background:#0056b3;}
  .nota{background:#fff;padding:15px;border-radius:10px;margin-top:20px;}
  .controle{background:#e8ffe8;padding:15px;border-radius:10px;margin-top:20px;}
  .qr-area{display:flex;align-items:center;gap:10px;margin-top:10px;flex-wrap:wrap;}
  #qrcode{background:#fff;padding:8px;border-radius:10px;}
  .total-box{background:#c9f7c5;padding:10px;border-radius:10px;margin-top:10px;text-align:center;font-size:18px;font-weight:bold;}
  .limpar{background:#dc3545;margin-left:10px;}
  .limpar:hover{background:#a71d2a;}
  .copy-msg{color:green;font-weight:bold;margin-left:5px;}
  .whatsapp{background:#25d366;}
  .whatsapp:hover{background:#1da851;}
</style>
</head>
<body>
  <div class="container">
    <h1>üìã Or√ßamento - G√™nesis Azulejista</h1>

    <div class="card">
      <label>Nome do Cliente</label>
      <input type="text" id="nome">

      <label>Descri√ß√£o do Servi√ßo</label>
      <textarea id="descricao" rows="3"></textarea>

      <label>Valor Total (R$)</label>
      <input type="number" id="valor" step="0.01">

      <label>Valor Recebido / Sinal (R$)</label>
      <input type="number" id="sinal" step="0.01">

      <label>Como entrou</label>
      <select id="forma">
        <option value="PIX">PIX</option>
        <option value="Dinheiro">Dinheiro</option>
        <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
      </select>

      <label>Restante combinado para pagamento</label>
      <input type="date" id="dataRestante">

      <label>Data de In√≠cio</label>
      <input type="date" id="inicio">

      <label>Data de T√©rmino</label>
      <input type="date" id="termino">

      <label>Prestador (Nome)</label>
      <input type="text" id="prestador" value="G√™nesis Azulejista">

      <label>CPF do Prestador</label>
      <input type="text" id="cpf" value="123.456.789-00">

      <label>Chave PIX</label>
      <input type="text" id="chavePix" value="04461680681">

      <div class="qr-area">
        <div id="qrcode"></div>
        <button onclick="gerarQR()">Gerar QR PIX</button>
        <button onclick="copiarChave()">üìã Copiar Chave PIX</button>
        <span id="copyMsg" class="copy-msg" style="display:none;">‚úÖ Copiada!</span>
      </div>

      <button onclick="gerarNota()">Gerar Nota e Salvar</button>
      <button class="limpar" onclick="limparCampos()">üîÑ Limpar e iniciar outro</button>
    </div>

    <div id="notaGerada" class="nota" style="display:none;"></div>

    <div class="controle">
      <h3>üìä Controle do M√™s</h3>
      <div id="listaControle"></div>
      <div class="total-box">
        üí∞ Total do M√™s: R$ <span id="totalMes">0,00</span>
      </div>
      <button class="limpar" onclick="limparControle()">üóëÔ∏è Limpar Controle</button>
    </div>
  </div>

<script>
let registros = JSON.parse(localStorage.getItem("orcamentos3")) || [];

function gerarQR(){
  const chave = document.getElementById('chavePix').value;
  const sinal = parseFloat(document.getElementById('sinal').value)||0;
  if(!chave){alert("Informe a chave PIX!");return;}
  const texto = `Pagamento para ${chave}\nValor: R$ ${sinal.toFixed(2)}`;
  document.getElementById('qrcode').innerHTML="";
  QRCode.toCanvas(texto,{width:150},function(err,canvas){
    if(err){alert("Erro ao gerar QR.");return;}
    document.getElementById('qrcode').appendChild(canvas);
  });
}

function copiarChave(){
  const chave = document.getElementById('chavePix').value;
  if(!chave){alert("Nenhuma chave PIX informada.");return;}
  navigator.clipboard.writeText(chave).then(()=>{
    const msg=document.getElementById("copyMsg");
    msg.style.display="inline";
    setTimeout(()=>msg.style.display="none",2000);
  });
}

function gerarNota(){
  const nome=document.getElementById('nome').value;
  const descricao=document.getElementById('descricao').value;
  const valor=parseFloat(document.getElementById('valor').value)||0;
  const sinal=parseFloat(document.getElementById('sinal').value)||0;
  const forma=document.getElementById('forma').value;
  const dataRestante=document.getElementById('dataRestante').value;
  const inicio=document.getElementById('inicio').value;
  const termino=document.getElementById('termino').value;
  const prestador=document.getElementById('prestador').value;
  const cpf=document.getElementById('cpf').value;
  const chavePix=document.getElementById('chavePix').value;

  if(!nome || !valor){alert("Preencha nome e valor total!");return;}

  const notaHTML=`
    <h2>Nota de Or√ßamento</h2>
    <p><strong>Cliente:</strong> ${nome}</p>
    <p><strong>Servi√ßo:</strong> ${descricao}</p>
    <p><strong>Valor Total:</strong> R$ ${valor.toFixed(2)}</p>
    <p><strong>Valor Recebido:</strong> R$ ${sinal.toFixed(2)} (${forma})</p>
    <p><strong>Restante combinado:</strong> ${dataRestante?new Date(dataRestante).toLocaleDateString('pt-BR'):"-"}</p>
    <p><strong>In√≠cio:</strong> ${inicio} - <strong>T√©rmino:</strong> ${termino}</p>
    <hr>
    <p><strong>Prestador:</strong> ${prestador} - CPF: ${cpf}</p>
    ${forma==="PIX"?`<p><strong>Chave PIX:</strong> ${chavePix}</p>`:""}
    <p style="text-align:center;">üíº G√™nesis Azulejista - BH e Regi√£o</p>
    <button class="whatsapp" onclick="enviarWhatsApp('${nome}','${descricao}','${valor}','${sinal}','${forma}','${chavePix}')">üì≤ Enviar via WhatsApp</button>
  `;
  document.getElementById('notaGerada').innerHTML=notaHTML;
  document.getElementById('notaGerada').style.display="block";

  const registro={nome,descricao,valor,sinal,forma,dataRestante,inicio,termino,prestador,cpf,chavePix,data:new Date().toLocaleDateString()};
  registros.push(registro);
  localStorage.setItem("orcamentos3",JSON.stringify(registros));
  atualizarControle();
}

function enviarWhatsApp(nome,descricao,valor,sinal,forma,chavePix){
  const msg = `üìã *Or√ßamento - G√™nesis Azulejista*\n\nüë§ Cliente: ${nome}\nüß± Servi√ßo: ${descricao}\nüí∞ Valor Total: R$ ${valor}\nüíµ Sinal Recebido: R$ ${sinal} (${forma})\n\nüîë Chave PIX: ${chavePix}\n\nüìÖ Obrigado por confiar em nosso trabalho!`;
  const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
}

function atualizarControle(){
  const lista=document.getElementById('listaControle');
  lista.innerHTML="";
  let total=0;
  registros.forEach(r=>{
    total+=r.valor;
    lista.innerHTML+=`<p>üß± ${r.nome} - ${r.forma} - R$ ${r.valor.toFixed(2)} (${r.data})</p>`;
  });
  document.getElementById('totalMes').innerText=total.toFixed(2);
}

function limparCampos(){
  document.querySelectorAll("input:not([id='prestador']):not([id='cpf']):not([id='chavePix']), textarea").forEach(el=>el.value="");
  document.getElementById("notaGerada").style.display="none";
  document.getElementById("qrcode").innerHTML="";
}

function limparControle(){
  if(confirm("Tem certeza que deseja limpar todo o controle do m√™s?")){
    registros=[];
    localStorage.removeItem("orcamentos3");
    atualizarControle();
  }
}

atualizarControle();
</script>
</body>
</html>
